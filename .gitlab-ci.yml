include:
 - project: acc-co/devops/python/acc-py-devtools
   file: acc_py_devtools/templates/gitlab-ci/python.yml

variables:
  # For test_lint and test_dev, $project_name is a path; for test_install and
  # test_wheel, it's a package name! Hence, we override it in the latter two
  # jobs.
  project_name: cernml.extremum_seeking
  PY_VERSION: "3.7"

build_wheel:
  extends:
    - .acc_py_build_wheel

test_lint:
  extends: .acc_py_base
  stage: test
  before_script:
    - pip install 'black' 'pylint' 'mypy' '.[test,examples]'
  script:
    - cd "${project_root}"
    - ./run_linters.sh ./src ./examples

test_dev:
  extends: .acc_py_dev_test
  script:
    - pip install -e '.[test]'
    - cd ${project_root}
    - pytest ./src ./tests --cov=${project_name} --junitxml=report.xml

test_wheel:
  extends: .acc_py_wheel_test
  variables:
    PYTEST_ADDOPTS: "-c ${CI_PROJECT_DIR}/pyproject.toml"

release_wheel:
  extends: .acc_py_release_wheel
